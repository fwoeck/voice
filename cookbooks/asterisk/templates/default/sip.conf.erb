[general]
context=adhearsion
allowguest=no
allowoverlap=yes
udpbindaddr=0.0.0.0
tcpenable=yes
tcpbindaddr=0.0.0.0
tlsenable=yes
tlsbindaddr=0.0.0.0
transport=udp,tls,wss
srvlookup=yes

disallow=all
allow=opus
allow=speex16
allow=alaw
allow=ulaw
allow=h264

videosupport=no

tlscertfile=/etc/asterisk/asterisk.pem
tlscafile=/etc/asterisk/ca.crt
tlscipher=ALL
tlsclientmethod=tlsv1

<% if node[:sipgate][:activate] %>
register => <%= node[:sipgate][:trunk] %>:<%= node[:sipgate][:pass] %>@<%= node[:sipgate][:proxy] %>/<%= node[:sipgate][:trunk] %>
<% end %>
<% if node[:skype][:activate] %>
register => <%= node[:skype][:trunk] %>:<%= node[:skype][:pass] %>@<%= node[:skype][:proxy] %>/<%= node[:skype][:trunk] %>
<% end %>

externaddr=<%= node[:etc][:external_ip] %>

directmedia=no
nat=force_rport,comedia
rtcachefriends=yes
autodomain=yes
allowexternaldomains=yes

domain=<%= node[:etc][:external_ip] %>
domain=<%= node[:etc][:domain] %>
domain=<%= node[:hostname][/[^.]+/] %>.<%= node[:etc][:domain] %>

jbenable=yes
jbforce=no
jbmaxsize=200
jbimpl=adaptive

encryption=no
avpf=yes
force_avp=yes
icesupport=yes
dtlsenable=yes
dtlsverify=fingerprint
dtlscertfile=/etc/asterisk/asterisk.pem
dtlscafile=/etc/asterisk/ca.crt
dtlssetup=actpass

[authentication]
<% if node[:sipgate][:activate] %>

[<%= node[:sipgate][:proxy] %>]
  type=peer
  host=<%= node[:sipgate][:proxy] %>
  outboundproxy=<%= node[:sipgate][:proxy] %>
  port=5060
  defaultuser=<%= node[:sipgate][:trunk] %>
  fromuser=<%= node[:sipgate][:trunk] %>
  fromdomain=<%= node[:sipgate][:proxy] %>
  secret=<%= node[:sipgate][:pass] %>
  dtmfmode=rfc2833
  insecure=port,invite
  canreinvite=no
  registertimeout=600
  disallow=all
  allow=speex16
  allow=alaw
  allow=h264
<% end %>
<% if node[:skype][:activate] %>

[<%= node[:skype][:proxy] %>]
	type=friend
  host=<%= node[:skype][:proxy] %>
  defaultuser=<%= node[:skype][:trunk] %>
  fromuser=<%= node[:skype][:trunk] %>
  fromdomain=<%= node[:skype][:proxy] %>
  secret=<%= node[:skype][:pass] %>
	qualify=yes
  dtmfmode=rfc2833
  insecure=port,invite
  canreinvite=no
  registertimeout=600
  disallow=all
  allow=g729
  allow=alaw
<% end %>
