# Compulsory parameters - start

host      = 'voice01'                 # Host name of this node
domain    = 'wimdu.com'               # Domain name of this node
fqdn      = "#{host}.#{domain}"

ipaddress = '33.33.33.100'            # Ip address of external interface
gateway   = '33.33.33.1'              # Ip address of gateway
interface = 'eth0'                    # External interface

localnet  = '192.168.178.0'           # Environmental local net
netmask   = '255.255.255.0'           # Netmask of environment

chef_role = 'desktop'                 # Set to 'server' for production-environment
gitbase   = 'git://github.com/fwoeck' # Set to 'git@github.com:<gh-user>' for private forks

# Compulsory parameters - end


Vagrant.configure('2') do |config|

  config.vm.define host do |config|
    config.vm.network             :private_network, ip: ipaddress
    config.vm.box               = 'voice-base'
    config.vm.box_url           = 'http://dokmatic-cdn.s3.amazonaws.com/wimdu/voice-base.box'
    config.vm.hostname          = fqdn

    config.ssh.forward_agent    = true
    config.ssh.username         = chef_role == 'server' ? 'wim' : 'vagrant'
    config.omnibus.chef_version = :latest
  end


  config.vm.provider 'virtualbox' do |v|
    v.customize ['modifyvm', :id, '--memory', '4096', '--cpus', '4']
    v.customize ['modifyvm', :id, '--natdnshostresolver1', 'on']
    v.customize ['modifyvm', :id, '--natdnsproxy1', 'on']
    v.customize ['modifyvm', :id, '--ioapic', 'on']
  end


  config.vm.provision :chef_solo do |chef|
    chef.custom_config_path = 'Vagrantfile.chef'
    chef.cookbooks_path     = 'cookbooks'
    chef.roles_path         = 'roles'
    chef.node_name          =  host
    chef.log_level          = :info

    chef.add_role(chef_role)

    chef.json = {
      'ahn' => {
        'ami_pass' => '<password>'
      },
      'aws' => {
        'gpg_pass'  => '<password>',
        'key_id'    => '<your-aws-key-id>',
        'secret'    => '<your-aws-secret>',
        's3_backup' => 's3-eu-west-1.amazonaws.com/<bucket-name>'
      },
      'crm_provider' => {
        'name'       => 'Zendesk',
        'user'       => '<your-email>',
        'pass'       => '<password>',
        'domain'     => '<zendesk-domain>',
        'api_url'    => 'https://<zendesk-domain>.zendesk.com/api/v2',
        'user_url'   => 'https://<zendesk-domain>.zendesk.com/agent/#/users/USERID/requested_tickets',
        'ticket_url' => 'https://<zendesk-domain>.zendesk.com/agent/#/tickets/TID'
      },
      'etc' => {
        'domain'          => domain,
        'external_ip'     => ipaddress,
        'ext_interface'   => interface,
        'deployment_host' => '<ext-production-host>',
        'ip_blacklist'    => ['23.250.10.130', '37.8.0.0/16', '37.59.0.0/16', '37.75.0.0/16', '37.187.0.0/16'],
        'ip_whitelist'    => [gateway],
        'gateway'         => gateway,
        'local_net'       => localnet,
        'local_mask'      => netmask
      },
      'git' => {
        'user' => {
          'name'  => '<your-name>',
          'email' => '<your-git-email>'
        },
        'github' => {
          'user'  => '<your-github-user>',
          'token' => '<password>'
        }
      },
      'mysql' => {
        'wim_pass'  => '<password>',
        'root_pass' => '<password>'
      },
      'postfix' => {
        'mail_domain'  => '<your-mx-host>',
        'local_admin'  => 'admin@mail.com',
        'remote_admin' => 'admin@mail.com'
      },
      'rabbitmq' => {
        'pass' => '<password>'
      },
      'sip_provider' => {
        'activate'   => false,
        'pass'       => '<password>',
        'trunk'      => '<your-sip-user>',
        'number'     => '<your-sip-number>',
        'sms' => {
          'apihost'  => 'api.sipgate.net',
          'password' => '<password>',
          'user'     => '<your-sms-user>'
        },
        'proxy'      => 'sipconnect.sipgate.de'
      },
      'skype' => {
        'activate' => false,
        'pass'     => '<password>',
        'trunk'    => '<your-sip-user>',
        'proxy'    => 'sip.skype.com'
      },
      'smtp' => {
        'address'  => 'email-smtp.eu-west-1.amazonaws.com',
        'port'     => '25',
        'username' => '<your-smtp-user>',
        'password' => '<password>'
      },
      'vnc' => {
        'password' => '<password>'
      },
      'voice_rails' => {
        'keybase'    => '<a-very-long-unique-key>',
        'admin' =>
          'email'    => 'admin@email.com',
          'fullname' => 'Admin User',
          'password' => 'P4ssw0rd',
          'secret'   => '0000',
          'name'     => '999'
        }
      },
      'wim' => {
        'gitbase' => gitbase
      }
    }
  end
end
